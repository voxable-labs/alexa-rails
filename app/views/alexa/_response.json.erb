{
  "version": "1.0",
  "sessionAttributes": <%= raw (response.intent.session || {}).to_json %>,
  "response": {
    <%- if response.device.apl_supported? %>
      "directives": [<%=
        apl_path = response.partial_path(format: :apl)

        # TODO: This will break elicitation directives.
        if File.exists?(Rails.root.join("app/views", apl_path))
          raw render(
            file: apl_path,
            locals: { response: response }
          )
        end
      %>],
    <%- end %>
    "outputSpeech": <%= raw render(partial: 'alexa/output/ssml', locals: { response: response }) %>,
    <% if false %>"card": <%= raw render(partial: 'alexa/output/card', locals: { response: response }) %>,<% end %>
    <% if content_for(:repromt_ssml).present? %>
      "reprompt": {
        "outputSpeech": {
          "type": "SSML",
          "ssml": <%= raw content_for(:repromt_ssml).strip.gsub(/\n/, "").to_json %>
        }
      },
    <% end %>
    "shouldEndSession": <%= response.end_session? %>
  }
}
